{"componentChunkName":"component---src-templates-post-template-js","path":"/landsliding-into-postgis-with-kml-files","result":{"data":{"markdownRemark":{"id":"e8a7fd42-20c9-551d-8e5c-313816eec3eb","html":"<p><a href=\"https://www.flickr.com/photos/hitchster/2871036863/\" title=\"Landslide damaged roadway (2005) by Hitchster, on Flickr\"><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 235px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 133.19148936170214%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAWRsrlxysy26j2lZMN//xAAcEAACAgIDAAAAAAAAAAAAAAABAgMRACEEMTL/2gAIAQEAAQUCPLW3V5CYayBAqHGu42K4zizsjcZ9N3//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERD/2gAIAQMBAT8BTK//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERD/2gAIAQIBAT8BXI//xAAeEAABAwQDAAAAAAAAAAAAAAAhAAERAhAxQQNhkf/aAAgBAQAGPwKONpVUiXxbZ2t+LKYjtA2ab//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExQXGR/9oACAEBAAE/Iajb9YxF0F5wN/sKKJ1TyIBN/YXGOrB2CPimb7EWXUbfXk4/GLc//9oADAMBAAIAAwAAABBvAbP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABFR/9oACAEDAQE/EA7ZgtF//8QAFxEAAwEAAAAAAAAAAAAAAAAAABARMf/aAAgBAgEBPxDCyp//xAAeEAEAAgEFAQEAAAAAAAAAAAABABEhMUFRYfBxkf/aAAgBAQABPxA1p0NDPAQW0RMRqt4qAaHmkH36Czuo/IadQTHXxj0snTBBSqJseaT2It9gS7ZK3I6I6YxFFEc+6hx5qirx7MTUr5P/2Q==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/85eb29e8030cb4c302fe5308e32d8fc6/e572b/postgis_kml.webp 235w\" sizes=\"(max-width: 235px) 100vw, 235px\" type=\"image/webp\">\n        <source srcset=\"/static/85eb29e8030cb4c302fe5308e32d8fc6/9fbb0/postgis_kml.jpg 235w\" sizes=\"(max-width: 235px) 100vw, 235px\" type=\"image/jpeg\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/85eb29e8030cb4c302fe5308e32d8fc6/9fbb0/postgis_kml.jpg\" alt=\"Landslide damaged roadway (2005)\" title=\"Landslide damaged roadway (2005)\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n    </span></a></p>\n<p>In this post I will show, in repeatable steps, how to install <a href=\"https://postgis.refractions.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PostGIS</a>, load in geospatial data found in a <a href=\"https://en.wikipedia.org/wiki/Keyhole_Markup_Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KML</a> file and run queries against that data. The focus of this geospatial data will be landslides and our resulting database will allow us to query, using longitude and latitude co-ordinates, the landslide status of a specific geographical point. The returned status for the given co-ordinates will be “Mostly Landslides”, “Few Landslides”, “Flat Land”, “Not Mapped”.</p>\n<h2 id=\"kml--kmz-files\" style=\"position:relative;\"><a href=\"#kml--kmz-files\" aria-label=\"kml  kmz files permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KML / KMZ Files</h2>\n<p>KML files define, in XML, geographical data in three dimensions. A <em>KMZ</em> file is simply a zipped KML file.</p>\n<p>You can find many weird and wonderful KML files on the Internet, either via <a href=\"https://www.google.ca/search?q=kml+files\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google Search</a> or via <a href=\"https://www.google.com/gadgets/directory?synd=earth&#x26;cat=featured&#x26;preview=on\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google Earth Gallery</a>.</p>\n<blockquote>\n<p>\n<strong>Keyhole Markup Language (KML)</strong> is an XML schema for expressing geographic annotation and visualization within Internet-based, two-dimensional maps and three-dimensional Earth browsers. KML was developed for use with Google Earth, which was originally named Keyhole Earth Viewer. It was created by Keyhole, Inc, which was acquired by Google in 2004. The name “Keyhole” is an homage to the KH reconnaissance satellites, the original eye-in-the-sky military reconnaissance system first launched in 1976. KML is an international standard of the Open Geospatial Consortium. Google Earth was the first program able to view and graphically edit KML files.<br>\n– <a href=\"https://en.wikipedia.org/wiki/Keyhole_Markup_Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KML Wikipedia</a></p>\n</blockquote>\n<h2 id=\"postgis\" style=\"position:relative;\"><a href=\"#postgis\" aria-label=\"postgis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PostGIS</h2>\n<p><a href=\"https://postgis.refractions.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PostGIS</a> is the number one architecture for dealing with geospatial data within a relational database. It works within PostgreSQL.</p>\n<p>While working with <a href=\"https://www.netsign.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">netSIGN</a> I had the opportunity to work briefly with PostGIS, which provides support for geographic objects within PostgreSQL. In that instance I was precisely identifying real-estate locations from longitude and latitude co-ordinates using <a href=\"https://data.vancouver.ca/datacatalogue/localAreaBoundary.htm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The City Of Vancouver’s Area Boundary KML file</a>. This time we will be looking at <a href=\"https://earthquake.usgs.gov/regional/nca/bayarea/landslides.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">San Francisco Bay-Area Landslides</a>.</p>\n<h3 id=\"installing-postgis\" style=\"position:relative;\"><a href=\"#installing-postgis\" aria-label=\"installing postgis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing PostGIS</h3>\n<p>On Mac OS X you can install both PostGIS, and it’s dependency PostgreSQL, with <a href=\"/homebrew-intro-to-the-mac-os-x-package-installer\">Homebrew</a>. For simplicity we assume that you already have PostgreSQL installed. </p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">sudo brew install postgis</span></span></code></pre>\n<h3 id=\"configuring-postgis\" style=\"position:relative;\"><a href=\"#configuring-postgis\" aria-label=\"configuring postgis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring PostGIS</h3>\n<p>Login as the <em>postgres</em> user.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">sudo su postgres</span></span></code></pre>\n<h3 id=\"create-a-postgis-template-database\" style=\"position:relative;\"><a href=\"#create-a-postgis-template-database\" aria-label=\"create a postgis template database permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create A PostGIS Template Database</h3>\n<p>Now we will create a template database for PostGIS within PostgreSQL from which we can create our own PostGIS database.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">TEMPLATE_DB_NAME=template_postgis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create the template spatial database.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">createdb -E UTF8 $TEMPLATE_DB_NAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Add PLPGSQL language support.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">createlang -d $TEMPLATE_DB_NAME plpgsql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Load the PostGIS extensions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">for</span><span class=\"mtk1\"> SQL_NAME </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> postgis postgis_comments spatial_ref_sys</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    psql -d $TEMPLATE_DB_NAME -f /usr/local/Cellar/postgis/1.5.2/share/postgis/$SQL_NAME.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">done</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Finalize our PostGIS template database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">cat &lt;&lt;EOS </span><span class=\"mtk7\">|</span><span class=\"mtk1\"> psql -d $TEMPLATE_DB_NAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">UPDATE pg_database SET datistemplate = TRUE WHERE datname = </span><span class=\"mtk6\">&#39;$TEMPLATE_DB_NAME&#39;</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">REVOKE ALL ON SCHEMA public FROM public</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">GRANT USAGE ON SCHEMA public TO public</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">GRANT ALL ON SCHEMA public TO postgres</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE public.geometry_columns TO PUBLIC</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">GRANT SELECT, UPDATE, INSERT, DELETE ON TABLE public.spatial_ref_sys TO PUBLIC</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">VACUUM FULL FREEZE</span><span class=\"mtk7\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">EOS</span></span></span></code></pre>\n<h3 id=\"create-the-database-from-the-template\" style=\"position:relative;\"><a href=\"#create-the-database-from-the-template\" aria-label=\"create the database from the template permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create The Database From The Template</h3>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">DB_NAME=</span><span class=\"mtk6\">&quot;landslide_db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">DB_USER=</span><span class=\"mtk6\">&quot;landslide_user&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">createuser --no-superuser --createdb --no-createrole $DB_USER</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">createdb --template=template_postgis --encoding=UTF8 --owner=$DB_USER $DB_NAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;GRANT ALL ON SCHEMA public TO </span><span class=\"mtk1\">$DB_USER</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">|</span><span class=\"mtk1\"> psql $DB_NAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">for</span><span class=\"mtk1\"> t </span><span class=\"mtk7\">in</span><span class=\"mtk1\"> geography_columns geometry_columns spatial_ref_sys</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;ALTER TABLE </span><span class=\"mtk1\">$t</span><span class=\"mtk6\"> OWNER TO </span><span class=\"mtk1\">$DB_USER</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">|</span><span class=\"mtk1\"> psql -d $DB_NAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">done</span></span></span></code></pre>\n<h2 id=\"preparing-the-geospatial-data-for-postgis\" style=\"position:relative;\"><a href=\"#preparing-the-geospatial-data-for-postgis\" aria-label=\"preparing the geospatial data for postgis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preparing The Geospatial Data For PostGIS</h2>\n<p>I will use some test data from <a href=\"https://earthquake.usgs.gov/regional/nca/bayarea/landslides.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">San Francisco Bay-Area Landslides</a>. From <a href=\"https://earthquake.usgs.gov\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">earthquake.usgs.gov</a> we can download a <a href=\"https://earthquake.usgs.gov/regional/nca/bayarea/kml/landslides.kmz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KMZ file</a> which contains the geographic information, in the form of 2-D polygons, of the landslide areas.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">wget https://earthquake.usgs.gov/regional/nca/bayarea/kml/landslides.kmz</span></span></span></code></pre>\n<h3 id=\"converting-kml-file-to-esri-shapefile-using-ogr2ogr\" style=\"position:relative;\"><a href=\"#converting-kml-file-to-esri-shapefile-using-ogr2ogr\" aria-label=\"converting kml file to esri shapefile using ogr2ogr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Converting KML File To ESRI Shapefile Using Ogr2ogr</h3>\n<p>We need to install the <em>ogr2ogr</em> command-line conversion tool. This is included with <a href=\"https://www.gdal.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gdal</a> and <a href=\"https://fwtools.maptools.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FWTools</a>. If you install <em>gdal-bin</em> on Linux via <em>apt-get</em> then you will probably get an older version that does not decode KML 2.2 files (required in this example). I recommend building <a href=\"https://trac.osgeo.org/gdal/wiki/DownloadSource\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gdal-bin from source</a> on Linux.</p>\n<p>On my Mac I will install gdal, and hence ogr2ogr, using <a href=\"/homebrew-intro-to-the-mac-os-x-package-installer\">Homebrew</a>.</p>\n<p>We first have to install <a href=\"https://code.google.com/p/libkml/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">libkml</a>, which is dependency of gdal if we want read KML 2.2 files. libkml is a KML file parsing engine written by Google and is used in Google Earth and Google Maps. Ogr2ogr can use libkml to read the KML files. It does have it’s own KML parser, but that will not work with the KML 2.2 file we will try to convert and generally is not as good as libkml at reading KML files. Usually, I would install libkml using <a href=\"/homebrew-intro-to-the-mac-os-x-package-installer\">Homebrew</a>, but I found that you can only install libkml 1.2 and gdal 1.8.0beta1 requires libkml 1.3. Therefore, I will install libkml from the libkml source respository, which is currently only way to get libkml 1.3.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sudo brew install libkml </span><span class=\"mtk3\"># only version 1.2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">svn checkout https://libkml.googlecode.com/svn/trunk libkml </span><span class=\"mtk3\"># currently version 1.3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">cd</span><span class=\"mtk1\"> libkml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">./autogen.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">./configure</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">make</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sudo make install</span></span></span></code></pre>\n<p>That’s libkml installed. Now, let’s use <a href=\"/homebrew-intro-to-the-mac-os-x-package-installer\">Homebrew</a> to install the latest version of gdal.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sudo brew install gdal --HEAD --complete</span></span></span></code></pre>\n<p>I use <em>–complete</em> to install all the additional file format parsers.</p>\n<p><em>–HEAD</em> is used to download the latest version from the gdal Subversion repository. I use –HEAD because, as of writing this, the current stable version is 1.7.3 and it does not provide libkml support, which is needed to read KML 2.2 files. The current version in Subversion is 1.8.0beta1.</p>\n<p>Now the <em>ogr2ogr</em> conversion utility should be installed. KMZ is a zipped KML file. It is just a regular zip file, so we can unzip this by simply using the unzip command. libkml does recognize the kmz extension, so we would not usually need to do this step, but landslides.kmz does not contain the data we want, only references to it via several <a href=\"https://code.google.com/apis/kml/documentation/kml_tut.html#network_links\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NetworkLinks</a> to other KMZ files. </p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">unzip landslides.kmz</span></span></span></code></pre>\n<p><small>If you have problems unzip a .kmz file, then simply rename to have a .zip extension</small></p>\n<p>When we unzip landslides.kmz, we find it contains only one file called <em>doc.kml</em>. Here is a what the doc.kml looks like…</p>\n<pre class=\"grvsc-container monokai\" data-language=\"xml\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;?</span><span class=\"mtk7\">xml</span><span class=\"mtk5\"> version</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;1.0&quot;</span><span class=\"mtk5\"> encoding</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;UTF-8&quot;</span><span class=\"mtk1\">?&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">kml</span><span class=\"mtk1\"> </span><span class=\"mtk5\">xmlns</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;https://www.opengis.net/kml/2.2&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">xmlns:gx</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;https://www.google.com/kml/ext/2.2&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">xmlns:kml</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;https://www.opengis.net/kml/2.2&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">xmlns:atom</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;https://www.w3.org/2005/Atom&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">Document</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;Landslides&lt;/</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">LookAt</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">longitude</span><span class=\"mtk1\">&gt;-122.2499999599815&lt;/</span><span class=\"mtk7\">longitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">latitude</span><span class=\"mtk1\">&gt;37.62500001065743&lt;/</span><span class=\"mtk7\">latitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">altitude</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">altitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">range</span><span class=\"mtk1\">&gt;413167.7811227545&lt;/</span><span class=\"mtk7\">range</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">tilt</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">tilt</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">heading</span><span class=\"mtk1\">&gt;2.443095370245979e-008&lt;/</span><span class=\"mtk7\">heading</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">altitudeMode</span><span class=\"mtk1\">&gt;relativeToGround&lt;/</span><span class=\"mtk7\">altitudeMode</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">LookAt</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">Style</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">ListStyle</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">listItemType</span><span class=\"mtk1\">&gt;checkHideChildren&lt;/</span><span class=\"mtk7\">listItemType</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">bgColor</span><span class=\"mtk1\">&gt;00ffffff&lt;/</span><span class=\"mtk7\">bgColor</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">maxSnippetLines</span><span class=\"mtk1\">&gt;2&lt;/</span><span class=\"mtk7\">maxSnippetLines</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">ListStyle</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">Style</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">NetworkLink</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;1&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;Aetna_Springs&lt;/</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">Region</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">LatLonAltBox</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;38.75&lt;/</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;38.625&lt;/</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">east</span><span class=\"mtk1\">&gt;-122.375&lt;/</span><span class=\"mtk7\">east</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">west</span><span class=\"mtk1\">&gt;-122.5&lt;/</span><span class=\"mtk7\">west</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minAltitude</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">minAltitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxAltitude</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">maxAltitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk7\">LatLonAltBox</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">Lod</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minLodPixels</span><span class=\"mtk1\">&gt;450&lt;/</span><span class=\"mtk7\">minLodPixels</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxLodPixels</span><span class=\"mtk1\">&gt;-1&lt;/</span><span class=\"mtk7\">maxLodPixels</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minFadeExtent</span><span class=\"mtk1\">&gt;128&lt;/</span><span class=\"mtk7\">minFadeExtent</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxFadeExtent</span><span class=\"mtk1\">&gt;128&lt;/</span><span class=\"mtk7\">maxFadeExtent</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk7\">Lod</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">Region</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">href</span><span class=\"mtk1\">&gt;https://earthquake.usgs.gov/regional/nca/bayarea/kml/Landslides/Landslides_Aetna_Springs.kmz&lt;/</span><span class=\"mtk7\">href</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">ViewRefreshMode</span><span class=\"mtk1\">&gt;onRegion&lt;/</span><span class=\"mtk7\">ViewRefreshMode</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">NetworkLink</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">NetworkLink</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;2&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;Allendale&lt;/</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">Region</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">LatLonAltBox</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;38.5&lt;/</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;38.375&lt;/</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">east</span><span class=\"mtk1\">&gt;-121.875&lt;/</span><span class=\"mtk7\">east</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">west</span><span class=\"mtk1\">&gt;-122&lt;/</span><span class=\"mtk7\">west</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minAltitude</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">minAltitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxAltitude</span><span class=\"mtk1\">&gt;0&lt;/</span><span class=\"mtk7\">maxAltitude</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk7\">LatLonAltBox</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">Lod</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minLodPixels</span><span class=\"mtk1\">&gt;450&lt;/</span><span class=\"mtk7\">minLodPixels</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxLodPixels</span><span class=\"mtk1\">&gt;-1&lt;/</span><span class=\"mtk7\">maxLodPixels</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">minFadeExtent</span><span class=\"mtk1\">&gt;128&lt;/</span><span class=\"mtk7\">minFadeExtent</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">maxFadeExtent</span><span class=\"mtk1\">&gt;128&lt;/</span><span class=\"mtk7\">maxFadeExtent</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk7\">Lod</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">Region</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">href</span><span class=\"mtk1\">&gt;https://earthquake.usgs.gov/regional/nca/bayarea/kml/Landslides/Landslides_Allendale.kmz&lt;/</span><span class=\"mtk7\">href</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">ViewRefreshMode</span><span class=\"mtk1\">&gt;onRegion&lt;/</span><span class=\"mtk7\">ViewRefreshMode</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">Link</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">NetworkLink</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">NetworkLink</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;3&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;Altamont&lt;/</span><span class=\"mtk7\">name</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">Region</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">LatLonAltBox</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;37.75&lt;/</span><span class=\"mtk7\">north</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;37.625&lt;/</span><span class=\"mtk7\">south</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p>Yes, KML is XML.</p>\n<p>You will notice several &#x3C;NetworkLink> blocks that contain a &#x3C;Link> block that contains &#x3C;href> tags that contain a web link to another KMZ file. Ideally these would be sucked in libkml when we parse the KML/KMZ file, but as Google says in it’s documentation…</p>\n<blockquote>\n<p>\nIn their simplest form, network links are a useful way to split one large KML file into smaller, more manageable files on the same computer.</p>\n<p>Despite the name, a &#x3C;NetworkLink> does not necessarily load files from the network.</p>\n<p><small><a href=\"https://code.google.com/apis/kml/documentation/kml_tut.html#network_links\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"> – Courtesy of Google’s KML documentation</a></small></p>\n</blockquote>\n<p>For this example, I’m just going to grab the first of these referenced KMZ files, <a href=\"https://earthquake.usgs.gov/regional/nca/bayarea/kml/Landslides/Landslides_Aetna_Springs.kmz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Landslides_Aetna_Springs.kmz</a>.</p>\n<p>We will first convert this KMZ into a ESRI Shapefile using ogr2ogr.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ogr2ogr -f </span><span class=\"mtk6\">&quot;ESRI Shapefile&quot;</span><span class=\"mtk1\"> landslides.shp Landslides_Aetna_Springs.kmz</span></span></span></code></pre>\n<p>Although, we got a few warnings, we did get our shapefile (actually, several files).</p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Warning 6: Normalized/laundered field name: &#39;description&#39; to &#39;descriptio&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Warning 6: Field timestamp create as date field, though DateTime requested.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Warning 6: Field begin create as date field, though DateTime requested.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Warning 6: Field end create as date field, though DateTime requested.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Warning 6: Normalized/laundered field name: &#39;altitudeMode&#39; to &#39;altitudeMo&#39;</span></span></code></pre>\n<p>The ESRI Shapefile comprises of these files, although we usually only need to reference the .shp file.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">landslides.shp</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">landslides.shx</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">landslides.prj</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">landslides.dbf</span></span></code></pre>\n<h3 id=\"converting-esri-shapefile-to-sql-using-shp2pgsql\" style=\"position:relative;\"><a href=\"#converting-esri-shapefile-to-sql-using-shp2pgsql\" aria-label=\"converting esri shapefile to sql using shp2pgsql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Converting ESRI Shapefile To SQL Using Shp2pgsql</h3>\n<p>Since PostGIS runs inside PostgreSQL, we are going need some SQL, so I will convert that ESRI Shapefile to SQL using the <em>shp2pgsql</em> command-line tool. The <em>shp2pgsql</em> tool comes with the PostGIS install, so you can run this from anywhere that you have installed PostGIS.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">shp2pgsql -s 4326 -I -c -W UTF-8 landslides.shp landslides &gt; landslides.sql</span></span></code></pre>\n<p>This generates <em>landslide.sql</em> which contains the geolocation data from Landslides_Aetna_Springs.kmz as SQL statements.</p>\n<p>-s specifies the SRID field. Since Google Maps uses SRID 4326 (“WGS84″) for this, we will use the same.</p>\n<blockquote>\n<p>\nA Spatial Reference System Identifier (SRID) is a unique value used to unambiguously identify projected, unprojected, and local spatial coordinate system definitions. These coordinate systems form the heart of all GIS applications.<br>\n<small><a href=\"https://en.wikipedia.org/wiki/SRID\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"> – Wikipedia</a></small></p>\n</blockquote>\n<p>We also specifiy <em>landslides</em> as the name of database table that we will be inserting into. landslides.sql will contain a create table statement using this name and the subsequent INSERT statements within landslides.sql will insert into this table.</p>\n<p>Here are the other options I have used for the <em>shp2pgsql</em> command.</p>\n<table>\n<tr>\n<td style=\"width: 30px\">-c</td>\n<td>Creates a new table and populates it, this is the default if you do not specify any options.</td>\n</tr>\n<tr>\n<td>-I</td>\n<td>Create a spatial index on the geocolumn.</td>\n</tr>\n<tr>\n<td>-S</td>\n<td>Generate simple geometries instead of MULTI geometries.</td>\n</tr><tr>\n<td>-W</td>\n<td>&lt;encoding&gt; Specify the character encoding of Shape’s attribute column. (default : “WINDOWS-1252″)</td>\n</tr>\n</table>\n<h3 id=\"multipolygons\" style=\"position:relative;\"><a href=\"#multipolygons\" aria-label=\"multipolygons permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multipolygons</h3>\n<p>Previously I have also used the <em>-S</em> switch with shp2pgsql, but for this KMZ file I got the following message.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">We have a Multipolygon with 40 parts, can&#39;t use -S switch!</span></span></code></pre>\n<table>\n<tr>\n<td>-S</td>\n<td>Generate simple geometries instead of MULTI geometries.</td>\n</tr><tr>\n</tr></table>\n<h2 id=\"the-sql\" style=\"position:relative;\"><a href=\"#the-sql\" aria-label=\"the sql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The SQL</h2>\n<p>Let’s take a look at the SQL generated…</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SET</span><span class=\"mtk1\"> CLIENT_ENCODING </span><span class=\"mtk7\">TO</span><span class=\"mtk1\"> UTF8;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SET</span><span class=\"mtk1\"> STANDARD_CONFORMING_STRINGS </span><span class=\"mtk7\">TO</span><span class=\"mtk1\"> </span><span class=\"mtk7\">ON</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">BEGIN</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;landslides&quot;</span><span class=\"mtk1\"> (gid </span><span class=\"mtk9 mtki\">serial</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PRIMARY</span><span class=\"mtk1\"> </span><span class=\"mtk7\">KEY</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;name&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk4\">80</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;descriptio&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk4\">80</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;timestamp&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">date</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;begin&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">date</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;end&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">date</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;altitudemo&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk4\">80</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;tessellate&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">numeric</span><span class=\"mtk1\">(</span><span class=\"mtk4\">10</span><span class=\"mtk1\">,</span><span class=\"mtk4\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;extrude&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">numeric</span><span class=\"mtk1\">(</span><span class=\"mtk4\">10</span><span class=\"mtk1\">,</span><span class=\"mtk4\">0</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;visibility&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">numeric</span><span class=\"mtk1\">(</span><span class=\"mtk4\">10</span><span class=\"mtk1\">,</span><span class=\"mtk4\">0</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> AddGeometryColumn(</span><span class=\"mtk6\">&#39;&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;landslides&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;the_geom&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;4326&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;MULTIPOLYGON&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk4\">4</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">INTO</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;landslides&quot;</span><span class=\"mtk1\"> (</span><span class=\"mtk6\">&quot;name&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;descriptio&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;timestamp&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;begin&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;end&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;altitudemo&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;tessellate&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;extrude&quot;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&quot;visibility&quot;</span><span class=\"mtk1\">,the_geom) </span><span class=\"mtk7\">VALUES</span><span class=\"mtk1\"> (</span><span class=\"mtk6\">&#39;Mostly Landslide&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;Mostly Landslide&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;1&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;0&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;-1&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&#39;01060000E0E61000002800000001030000E0E610000001000000060000009B559FABAD985EC0000000000060434000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">0000000F03F0000000000000000C0EC9E3C2C985EC00000000000604340000000000000F03F0000000000000000711B0DE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">02D985EC032207BBDFB5F4340000000000000F03F0000000000000000386744696F985EC032207BBDFB5F4340000000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">000F03F000000000000000038F8C264AA985EC032207BBDFB5F4340000000000000F03F00000000000000009B559FABAD9</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">85EC00000000000604340000000000000F03F000000000000000001030000E0E61000000100000005000000613255302A9</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">95EC00000000000604340000000000000F03F00000000000000004CA60A4625995EC00000000000604340000000000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">F03F0000000000000000FED478E926995EC0DC291DACFF5F4340000000000000F03F0000000000000000B003E78C28995E</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">C00000000000604340000000000000F03F0000000000000000613255302A995EC00000000000604340000000000000F03F</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">0000000... (truncated)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">INSERT INTO &quot;landslides&quot; (&quot;name&quot;,&quot;descriptio&quot;,&quot;timestamp&quot;,&quot;begin&quot;,&quot;end&quot;,&quot;altitudemo&quot;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&quot;tessellate&quot;,&quot;extrude&quot;,&quot;visibility&quot;,the_geom) VALUES (&#39;</span><span class=\"mtk1\">Few Landslides</span><span class=\"mtk6\">&#39;,&#39;</span><span class=\"mtk1\">Few Landslides</span><span class=\"mtk6\">&#39;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">NULL,NULL,NULL,NULL,&#39;</span><span class=\"mtk4\">1</span><span class=\"mtk6\">&#39;,&#39;</span><span class=\"mtk4\">0</span><span class=\"mtk6\">&#39;,&#39;</span><span class=\"mtk7\">-</span><span class=\"mtk4\">1</span><span class=\"mtk6\">&#39;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">&#39;</span><span class=\"mtk1\">01060000E0E61000001B00000001030000E0E610000004000000490600000000000000985EC0A83AE466B85D434000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">0000000F03F0000000000000000C7BAB88D06985EC068B3EA73B55D4340000000000000F03F000000000000000040A4DF</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">BE0E985EC0282CF180B25D4340000000000000F03F0000000000000000075F984C15985EC02F51BD35B05D434000000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">0000F03F00000000000000006ABC749318985EC076FD82DDB05D4340000000000000F03F00000000000000001CEBE2361</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">A985EC004560E2DB25D4340000000000000F03F0000000000000000CE1951DA1B985EC0D95A5F24B45D43400000000000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">00F03F000000000000000095D4096822985EC0761A69A9BC5D4340000000000000F03F00000000000000004703780B249</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">85EC02849D74CBE5D4340000000000000F03F00000000000000005C8FC2F528985EC092CB7F48BF5D4340000000000000F</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">03F0000000000000000C0EC9E3C2C985EC0B6A1629CBF5D4340000000000000F03F0000000000000000234A7B832F985EC</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">092CB7F48BF5D4... (truncated)</span></span></span></code></pre>\n<p>The INSERT commands are pretty long, so I’ve truncated them here, but you can get the general idea.</p>\n<h2 id=\"loading-sql-into-postgis\" style=\"position:relative;\"><a href=\"#loading-sql-into-postgis\" aria-label=\"loading sql into postgis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Loading SQL Into PostGIS</h2>\n<p>We can now load the SQL we generated into our database. This is an easy step.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">psql -d $DB_NAME $DB_USER </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> landslides.sql</span></span></span></code></pre>\n<p>You see something like this, if all goes well.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SET</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SET</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">BEGIN</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">NOTICE:  </span><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> will </span><span class=\"mtk7\">create</span><span class=\"mtk1\"> implicit </span><span class=\"mtk7\">sequence</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;landslides_gid_seq&quot;</span><span class=\"mtk1\"> for </span><span class=\"mtk9 mtki\">serial</span><span class=\"mtk1\"> column </span><span class=\"mtk6\">&quot;landslides.gid&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">NOTICE:  </span><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">/</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PRIMARY</span><span class=\"mtk1\"> </span><span class=\"mtk7\">KEY</span><span class=\"mtk1\"> will </span><span class=\"mtk7\">create</span><span class=\"mtk1\"> implicit index </span><span class=\"mtk6\">&quot;landslides_pkey&quot;</span><span class=\"mtk1\"> for </span><span class=\"mtk7\">table</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;landslides&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                       addgeometrycolumn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">----------------------------------------------------------------</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk4\">public</span><span class=\"mtk1\">.</span><span class=\"mtk4\">landslides</span><span class=\"mtk1\">.the_geom SRID:</span><span class=\"mtk4\">4326</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk1\">:MULTIPOLYGON DIMS:</span><span class=\"mtk4\">4</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk4\">1</span><span class=\"mtk1\"> </span><span class=\"mtk7\">row</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> INDEX</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COMMIT</span></span></span></code></pre>\n<h2 id=\"running-sql-queries-against-our-postgis-database\" style=\"position:relative;\"><a href=\"#running-sql-queries-against-our-postgis-database\" aria-label=\"running sql queries against our postgis database permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running SQL Queries Against Our PostGIS Database</h2>\n<pre class=\"grvsc-container monokai\" data-language=\"bash\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">DB_NAME=</span><span class=\"mtk6\">&quot;landslide_db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">DB_USER=</span><span class=\"mtk6\">&quot;landslide_user&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">psql -d $DB_NAME $DB_USER</span></span></span></code></pre>\n<p>Our landslide database has four definitions of landslides, each mapping to a complex set of polgons (table column “the_geom” is TYPE:MULTIPOLYGON). Here are their names.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">landslide_db</span><span class=\"mtk7\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> landslides;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">       </span><span class=\"mtk7\">name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">------------------</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Mostly Landslide</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Few Landslides</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Flat Land</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk7\">Not</span><span class=\"mtk1\"> Mapped</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk4\">4</span><span class=\"mtk1\"> </span><span class=\"mtk7\">rows</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Let’s look for landslides at latitude and longtitude position -122.3800, 38.7499. Here we find a bad location (meaning you would not build your house there) since this is in the bounds of “Mostly Landslide”.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">landslide_db</span><span class=\"mtk7\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> landslides </span><span class=\"mtk7\">WHERE</span><span class=\"mtk1\"> ST_Contains(the_geom,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ST_GeomFromWKB(ST_AsEWKB(</span><span class=\"mtk6\">&#39;POINT(-122.3800 38.7499)&#39;</span><span class=\"mtk1\">::</span><span class=\"mtk7\">geometry</span><span class=\"mtk1\">), </span><span class=\"mtk4\">4326</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">       </span><span class=\"mtk7\">name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">------------------</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Mostly Landslide</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk4\">1</span><span class=\"mtk1\"> </span><span class=\"mtk7\">row</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Let’s find somewhere with less landslides. Maybe -122.3752, 38.7321?</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">landslide_db</span><span class=\"mtk7\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> landslides </span><span class=\"mtk7\">WHERE</span><span class=\"mtk1\"> ST_Contains(the_geom,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ST_GeomFromWKB(ST_AsEWKB(</span><span class=\"mtk6\">&#39;POINT(-122.3752 38.73215)&#39;</span><span class=\"mtk1\">::</span><span class=\"mtk7\">geometry</span><span class=\"mtk1\">), </span><span class=\"mtk4\">4326</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">----------------</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Few Landslides</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk4\">1</span><span class=\"mtk1\"> </span><span class=\"mtk7\">row</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>That is pretty good, but flat land would be better.</p>\n<pre class=\"grvsc-container monokai\" data-language=\"sql\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">landslide_db</span><span class=\"mtk7\">=&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> landslides </span><span class=\"mtk7\">WHERE</span><span class=\"mtk1\"> ST_Contains(the_geom,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ST_GeomFromWKB(ST_AsEWKB(</span><span class=\"mtk6\">&#39;POINT(-122.4015 38.74941)&#39;</span><span class=\"mtk1\">::</span><span class=\"mtk7\">geometry</span><span class=\"mtk1\">), </span><span class=\"mtk4\">4326</span><span class=\"mtk1\">));</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">   </span><span class=\"mtk7\">name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-----------</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> Flat Land</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span><span class=\"mtk4\">1</span><span class=\"mtk1\"> </span><span class=\"mtk7\">row</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Bingo! We’ve found some flat land that is landslide free. This seems like a safe place to conclude this blog post.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>In this blog post I went through the steps needed to convert and load a KML 2.2 file into a PostGIS enabled PostgreSQL database. We installed PostGIS and all the tools needed to convert our KML file into an ESRI Shapefile and then into SQL statements that could be ran in PostgreSQL. We can now run SQL queries against our database which will return the landslide status for any given longitude and latitude within the focus area.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/landsliding-into-postgis-with-kml-files","tagSlugs":["/tag/esri-shapefile/","/tag/gdal/","/tag/geo/","/tag/geographic/","/tag/geospatial/","/tag/gis/","/tag/homebrew/","/tag/kml/","/tag/kmz/","/tag/landslides/","/tag/latitude/","/tag/libkml/","/tag/longitude/","/tag/macosx/","/tag/ogr-2-ogr/","/tag/postgis/","/tag/postgresql/","/tag/shapefile/","/tag/shp/","/tag/sql/"]},"frontmatter":{"date":"2011-01-05T09:25:00-08:00","description":"In this post I will show, in repeatable steps, how to install PostGIS, load in geospatial data found in a KML file and run queries against that data. The focus of this geospatial data will be landslides and our resulting database will allow us to query, using longitude and latitude co-ordinates, the landslide status of a specific geographical point.","tags":["esri shapefile","gdal","geo","geographic","geospatial","gis","homebrew","kml","kmz","landslides","latitude","libkml","longitude","macosx","ogr2ogr","postgis","postgresql","shapefile","shp","sql"],"title":"Landsliding Into PostGIS With KML Files","socialImage":{"publicURL":{"publicURL":"/static/af07aa0a69c6ca8f13e143656091f8e1/postgis_kml_sq.jpg"}}}}},"pageContext":{"slug":"/landsliding-into-postgis-with-kml-files"}},"staticQueryHashes":["251939775","3942705351","401334301"]}