<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.2c71805a0a9667ed3610.css">.comments-header{font-size:1.2em}#comments li,#comments li li li,#comments li li li li li{overflow:hidden;margin:0 0 .9375rem;padding:.9375rem .9375rem 0;background:#fff;border:1px solid #ccc}#comments li li,#comments li li li li{background:#f9f9f9}.comment-meta{margin:.625rem 0 1.3125rem;font-size:.8125rem;color:#666}.comment-author{font-size:.9375rem;color:#000}.comment-edit-link,.comment-reply-link,.permalink{font-style:italic;color:#666}.comment-text{clear:left;margin:0 .9375rem}.comment img.avatar{padding:.625rem;float:left}code.grvsc-code{margin-left:unset;margin-right:unset}html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:55.9375rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:75rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:55.9375rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:55.9375rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:55.9375rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:55.9375rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.24.52"/><link rel="alternate" type="application/rss+xml" title="Big Fast Blog" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-15826070-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-15826070-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec" type="image/png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=c42cfc86b75f7cc51dd49ceb0f10b5ec"/><title data-react-helmet="true">Ruby’s EventMachine – Part 2 : Asynchronous != Faster - Big Fast Blog</title><meta data-react-helmet="true" name="description" content="In this post I will look synchronous vs asynchronous programming with Ruby&#x27;s EventMachine, to show that asynchronous does not always mean that your code will run faster. In part 1 of this series on Ruby&#x27;s EventMachine I discussed the benefits of event-based programming in general. I am a big fan of event-based programming, as you will see in these posts, but I wanted to flip the coin over and look at one of the down-sides of event-based programming."/><meta data-react-helmet="true" property="og:site_name" content="Ruby’s EventMachine – Part 2 : Asynchronous != Faster - Big Fast Blog"/><meta data-react-helmet="true" property="og:image" content="https://bigfastblog.com/media/images/photo.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Ruby’s EventMachine – Part 2 : Asynchronous != Faster - Big Fast Blog"/><meta data-react-helmet="true" name="twitter:description" content="In this post I will look synchronous vs asynchronous programming with Ruby&#x27;s EventMachine, to show that asynchronous does not always mean that your code will run faster. In part 1 of this series on Ruby&#x27;s EventMachine I discussed the benefits of event-based programming in general. I am a big fan of event-based programming, as you will see in these posts, but I wanted to flip the coin over and look at one of the down-sides of event-based programming."/><meta data-react-helmet="true" name="twitter:image" content="https://bigfastblog.com/media/images/photo.jpg"/><link as="script" rel="preload" href="/webpack-runtime-19035f8c288fb702f4ea.js"/><link as="script" rel="preload" href="/framework-d018bf9a55d82f10618c.js"/><link as="script" rel="preload" href="/app-1be3f86dc13de6efc5d3.js"/><link as="script" rel="preload" href="/styles-083a06cb5740baaf347d.js"/><link as="script" rel="preload" href="/b40c11bee3846ca70ab17cd1bc776b2e57af83cb-10791c46efc983490b73.js"/><link as="script" rel="preload" href="/643651a62fb35a9bb4f20061cb1f214a352d7976-921c08de707572e0b904.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-a0fc6e0c604116ad175d.js"/><link as="fetch" rel="preload" href="/page-data/ruby-eventmachine-part-2-asynchronous-not-equal-faster/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3942705351.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">Posts</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Ruby’s EventMachine – Part 2 : Asynchronous != Faster</h1><div class="Content-module--content__body--2TrQ-"><p>In this post I will look synchronous vs asynchronous programming with Ruby’s <a href="https://github.com/eventmachine/eventmachine" target="_blank" rel="nofollow noopener noreferrer">EventMachine</a>, to show that asynchronous does not always mean that your code will run faster.</p>
<p>In <a href="/rubys-eventmachine-part-1-event-based-programming">part 1</a> of this series on Ruby’s EventMachine I discussed the benefits of event-based programming in general. I am a big fan of event-based programming, as you will see in these posts, but I wanted to flip the coin over and look at one of the down-sides of event-based programming. </p>
<h2 id="the-cost" style="position:relative;"><a href="#the-cost" aria-label="the cost permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Cost</h2>
<p>Managing events does not come for free. There is overhead of wrapping code in callbacks, stashing context, queuing events, deleting events, managing timer events and communication the the operating system.</p>
<h2 id="exhibit-a" style="position:relative;"><a href="#exhibit-a" aria-label="exhibit a permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exhibit A</h2>
<p>With the example I am using for this post, we talk over a TCP network connection and perform a high number of transactions in a short period of time. If you read <a href="/rubys-eventmachine-part-1-event-based-programming">part 1</a>, then you will know that this sounds like an ideal use-case for EventMachine to really shine.</p>
<p>The example I am going to use is Memcached. Memcached is fast. If you have a low-latency network connection to Memached, then it is really fast.</p>
<p>Memcached, as its name implies, runs in memory, so the only thing that is going to slow it down is it being overwhelmed with network requests or some inefficiency in its algorithms (which are CPU bound). Personally, I have never hit the upper-bound of either of these, as there is always something else in the my architecture which croaks first.</p>
<h2 id="the-test" style="position:relative;"><a href="#the-test" aria-label="the test permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Test</h2>
<p>I wrote a test to see if asynchronous memcached communication, using EventMachine, or synchronous memcached communication, using the <a href="https://github.com/evan/memcached/blob/master/README.rdoc" target="_blank" rel="nofollow noopener noreferrer">memcached</a> gem, would be faster.</p>
<p>Here is the code…</p>
<pre class="grvsc-container monokai" data-language="ruby" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">require</span><span class="mtk1"> </span><span class="mtk6">&#39;eventmachine&#39;</span><span class="mtk1"> </span><span class="mtk3"># for async</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">require</span><span class="mtk1"> </span><span class="mtk6">&#39;memcached&#39;</span><span class="mtk1">    </span><span class="mtk3"># for sync</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">require</span><span class="mtk1"> </span><span class="mtk6">&#39;benchmark&#39;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">DEBUG </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">false</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">TEST_SIZE </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk4">100_000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">def</span><span class="mtk1"> </span><span class="mtk5">debug</span><span class="mtk1"> </span><span class="mtk10 mtki">msg</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">if</span><span class="mtk1"> DEBUG</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    $stderr.</span><span class="mtk9">puts</span><span class="mtk1"> msg</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">def</span><span class="mtk1"> </span><span class="mtk5">async</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">EM</span><span class="mtk1">.run </span><span class="mtk7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    cache </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9 mtki">EventMachine</span><span class="mtk1">::</span><span class="mtk9 mtki">Protocols</span><span class="mtk1">::</span><span class="mtk9 mtki">Memcache</span><span class="mtk1">.connect </span><span class="mtk6">&#39;localhost&#39;</span><span class="mtk1">, </span><span class="mtk4">11211</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;sending SET requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      cache.set </span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;value</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1"> </span><span class="mtk7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        debug </span><span class="mtk6">&quot;  SET key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;SET requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;sending GET requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      cache.get </span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1"> </span><span class="mtk7">do</span><span class="mtk1"> |value|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        debug </span><span class="mtk6">&quot;  GET key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> = </span><span class="mtk7">#{</span><span class="mtk1">value</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;GET requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;sending DEL requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      cache.del(</span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1">) </span><span class="mtk7">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        debug </span><span class="mtk6">&quot;  DEL key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">if</span><span class="mtk1"> n </span><span class="mtk7">==</span><span class="mtk1"> TEST_SIZE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk9 mtki">EM</span><span class="mtk1">.stop</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;DEL requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">def</span><span class="mtk1"> </span><span class="mtk5">sync</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  cache </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9 mtki">Memcached</span><span class="mtk1">.</span><span class="mtk7">new</span><span class="mtk1">(</span><span class="mtk6">&quot;localhost:11211&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;sending SET requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    cache.set </span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1">, </span><span class="mtk6">&quot;value</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;  SET key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;SET requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;sending GET requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    value </span><span class="mtk7">=</span><span class="mtk1"> cache.get </span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;  GET key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> = </span><span class="mtk7">#{</span><span class="mtk1">value</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;GET requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;sending DEL requests...&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  (</span><span class="mtk4">1</span><span class="mtk1">..TEST_SIZE).each </span><span class="mtk7">do</span><span class="mtk1"> |n|</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    cache.delete(</span><span class="mtk6">&quot;key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6">&quot;</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    debug </span><span class="mtk6">&quot;  DEL key</span><span class="mtk7">#{</span><span class="mtk1">n</span><span class="mtk7">}</span><span class="mtk6"> complete&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  debug </span><span class="mtk6">&quot;DEL requests sent&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">puts</span><span class="mtk1"> </span><span class="mtk9 mtki">Benchmark</span><span class="mtk1">.measure { </span><span class="mtk9">puts</span><span class="mtk1"> </span><span class="mtk6">&quot;sync:&quot;</span><span class="mtk1">;  sync  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">puts</span><span class="mtk1"> </span><span class="mtk9 mtki">Benchmark</span><span class="mtk1">.measure { </span><span class="mtk9">puts</span><span class="mtk1"> </span><span class="mtk6">&quot;async:&quot;</span><span class="mtk1">; async }</span></span></span></code></pre>
<h2 id="the-results" style="position:relative;"><a href="#the-results" aria-label="the results permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Results</h2>
<p>We are using <a href="https://ruby-doc.org/stdlib-1.9.3/libdoc/benchmark/rdoc/Benchmark.html" target="_blank" rel="nofollow noopener noreferrer">benchmark</a> to measure the time taken.</p>
<pre class="grvsc-container monokai" data-language="" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">$ ruby memcached.rb</span></span>
<span class="grvsc-line"><span class="grvsc-source">sync:</span></span>
<span class="grvsc-line"><span class="grvsc-source">  4.170000   4.360000   8.530000 ( 17.299242)</span></span>
<span class="grvsc-line"><span class="grvsc-source">async:</span></span>
<span class="grvsc-line"><span class="grvsc-source"> 32.150000   0.990000  33.140000 ( 33.246160)</span></span></code></pre>
<blockquote>
<p>
This report shows the user CPU time, system CPU time, the sum of the user and system CPU times, and the elapsed real time. The unit of time is seconds. (from <a href="https://ruby-doc.org/stdlib-1.9.3/libdoc/benchmark/rdoc/Benchmark.html" target="_blank" rel="nofollow noopener noreferrer">Benchmark docs</a>)</p>
</blockquote>
<p>So we can see from the above that EventMachine-based version took about twice as long to run, took 8 times as much user CPU time and over 4 times as much system CPU time. That is quite significant.</p>
<h2 id="avoid-eventmachine-with-memcached" style="position:relative;"><a href="#avoid-eventmachine-with-memcached" aria-label="avoid eventmachine with memcached permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Avoid EventMachine With Memcached?</h2>
<p>This test needs to be put in context. The test was being run on same machine as Memcached, so the network latency was extremely low. EventMachine was not being used for anything else and this script had no other tasks to perform in-between sending requests to Memcached and receiving the responses, so blocking was not an issue.</p>
<p>I could benchmark this and conclude that synchronous Memcached usage was the way to go. I would then roll it out to production, where Memcached is running on a different machine in a different data-center (please do not do this), and the latency would kill this synchronous script. Where you have latency and many requests, asynchronous event-based programming is usually going to win.</p>
<p>Therefore, if the context is such that this kind of synchronous model works better for you, performance is important and you can be sure that things are not going to change, then <em>maybe</em> it is worth consideration.</p>
<h2 id="suck-it-up" style="position:relative;"><a href="#suck-it-up" aria-label="suck it up permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Suck It Up</h2>
<p>Nearly everything application I write now is event-based. I use EventMachine in Ruby and Tornado’s <a href="https://www.tornadoweb.org/documentation/ioloop.html" target="_blank" rel="nofollow noopener noreferrer">io_loop</a> in Python. I write high performance code and do everything non-blocking, because I do not want anything to halt my event-loop, ever.</p>
<p>I will gladly take a little overhead and fire up a new process or a new machine, if necessary, if it means that an external service like Memcached will not bring my event-loop to a halt when it has issues. It may be fast now, but one network glitch or Memcached crash may render my event-loop defunct. I might go from processing 10k requests per second to processing 1 per second, if I have a timeout of 1 second on one blocking network connection. So, yes, I will gladly suck up this asynchronous overhead in the short-term to protect from [expected] unexpected issues in the future.</p>
<h2 id="can-eventmachine-be-faster" style="position:relative;"><a href="#can-eventmachine-be-faster" aria-label="can eventmachine be faster permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Can EventMachine Be Faster?</h2>
<p>I am a believer that anything can be better, faster, stronger. EventMachine is already heavily written in C++, which itself is a clear sign that its operation is CPU-bound.</p>
<p>There is a pure ruby implementation of EventMachine. You can play with this to compare the performance of the C++ implementation. In basic tests, you unlikely see a difference. The general benefit you get with an event-based system, when dealing with latency in disk and network I/O, far out-weighs the overhead of the event-system. It is only when you start to hit it extremely hard you will see the differences.</p>
<p>A faster EventMachine would be great, but it will make little difference to you when comparing with asynchronous code. You can never escape the overhead that asynchronous code adds. Therefore, synchronous code will continue to much look much faster in examples like the one above.</p>
<p>Event-based programming enables your application to utilize 100% of the cpu, because anything not cpu-bound can be passed off to the operating system. Therefore, if our code-base is truly event-based, we would only see the benefit of a faster EventMachine once we hit 100% utilization of the CPU.</p>
<p><strong>Side note:</strong> I have hit some bugs when using the pure-ruby implementation in my code and the EventMachine test-suite was not passing for me when trying to use pure-ruby. The test-suite is now passing with the latest HEAD of the <a href="https://github.com/eventmachine/eventmachine" target="_blank" rel="nofollow noopener noreferrer">git repository</a>, so these might have been a temporary issues, but it highlighted to me the order of priority for C++ vs pure-ruby implementations.</p>
<h2 id="resources" style="position:relative;"><a href="#resources" aria-label="resources permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resources</h2>
<ul>
<li><a href="https://groups.google.com/forum/?fromgroups=#!forum/eventmachine" target="_blank" rel="nofollow noopener noreferrer">EventMachine Mailing-list</a></li>
</ul>
<h2 id="rubys-eventmachine" style="position:relative;"><a href="#rubys-eventmachine" aria-label="rubys eventmachine permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ruby’s EventMachine</h2>
<p>Other posts in this series</p>
<ul>
<li><a href="/rubys-eventmachine-part-1-event-based-programming">Part 1 : Event-based Programming</a></li>
<li><a href="/ruby-eventmachine-part-2-asynchronous-not-equal-faster">Part 2 : Asynchronous != Faster</a></li>
</ul>
<h2 id="comments" style="position:relative;"><a href="#comments" aria-label="comments permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Comments</h2>
<div id="comments">
  <ol class="comment-list">
    <li id="comment-22146" class="comment even thread-even depth-1 comment reader">
      <img alt="yuan" src="https://0.gravatar.com/avatar/47081f2906ff164aadfa8eea575c4189?s=80&amp;d=https%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
      <div class="comment-meta comment-meta-data">
        <div class="comment-author vcard">
          <cite class="fn">yuan</cite>
        </div>
        <!-- .comment-author .vcard -->
        <abbr class="comment-date" title="Monday, September 24th, 2012, 7:56 pm">September 24, 2012</abbr> at <abbr class="comment-time" title="Monday, September 24th, 2012, 7:56 pm">7:56 pm</abbr>
      </div>
      <div class="comment-text">
        <p>great!  how can I integrate eventmachine to my rails apps?</p>
      </div>
      <!-- .comment-text -->
    </li>
    <!-- .comment -->
    <li id="comment-22151" class="comment odd alt thread-odd thread-alt depth-1 comment reader">
      <img alt="Ludovic Henry" src="https://0.gravatar.com/avatar/cfaf18c547ad83146d89bba7cdca1339?s=80&amp;d=https%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
      <div class="comment-meta comment-meta-data">
        <div class="comment-author vcard">
          <cite class="fn" title="https://ludovic-henry.com">Ludovic Henry</cite>
        </div>
        <!-- .comment-author .vcard -->
        <abbr class="comment-date" title="Monday, September 24th, 2012, 10:48 pm">September 24, 2012</abbr> at <abbr class="comment-time" title="Monday, September 24th, 2012, 10:48 pm">10:48 pm</abbr>
      </div>
      <div class="comment-text">
        <p>What are the results if you use epoll instead of select? Thank you.</p>
      </div>
      <!-- .comment-text -->
      <ol class="children">
        <li id="comment-22286" class="comment byuser comment-author-admin bypostauthor even depth-2 comment role-administrator user-admin entry-author">
          <img alt="Phil Whelan" src="https://1.gravatar.com/avatar/5f357d996da96ccd36d3374e3728bf29?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
          <div class="comment-meta comment-meta-data">
            <div class="comment-author vcard">
              <cite class="fn" title="https://www.google.com/profiles/101358683928607234715">Phil Whelan</cite>
            </div>
            <!-- .comment-author .vcard -->
            <abbr class="comment-date" title="Thursday, September 27th, 2012, 10:53 am">September 27, 2012</abbr> at <abbr class="comment-time" title="Thursday, September 27th, 2012, 10:53 am">10:53 am</abbr>
          </div>
          <div class="comment-text">
            <p>Hi Ludovic,</p>
            <p>I added EM.epoll before EM.run and here are the results</p>
            <pre>$ ruby memcached.rb
sync:
  3.950000   4.240000   8.190000 ( 16.496183)
async:
 40.090000   1.110000  41.200000 ( 41.708882)</pre>
            <p>Actually a little worse performance, but this is running on my Mac and epoll is for multiplexed I/O that is available in Linux 2.6 kernels.</p>
            <p>Cheers,<br>
Phil</p>
          </div>
          <!-- .comment-text -->
          <ol class="children">
            <li id="comment-22319" class="comment odd alt depth-3 comment reader">
              <img alt="Ludovic Henry" src="https://0.gravatar.com/avatar/cfaf18c547ad83146d89bba7cdca1339?s=80&amp;d=https%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
              <div class="comment-meta comment-meta-data">
                <div class="comment-author vcard">
                  <cite class="fn" title="https://ludovic-henry.com">Ludovic Henry</cite>
                </div>
                <!-- .comment-author .vcard -->
                <abbr class="comment-date" title="Friday, September 28th, 2012, 1:19 am">September 28, 2012</abbr> at <abbr class="comment-time" title="Friday, September 28th, 2012, 1:19 am">1:19 am</abbr>
              </div>
              <div class="comment-text">
                <p>If you are using OS/X &#x2013; BSD, you should be using kqueue with &#x201C;EM.kqueue = true if EM.kqueue?&#x201D;.</p>
                <p>About Epoll, if it&#x2019;s not available on the platform (not on linux2.6+), it should fallback to select..</p>
              </div>
              <!-- .comment-text -->
            </li>
            <!-- .comment -->
          </ol>
        </li>
        <!-- .comment -->
      </ol>
    </li>
    <!-- .comment -->
    <li id="comment-22451" class="comment even thread-even depth-1 comment reader">
      <img alt="Phil Pirozhkov" src="https://1.gravatar.com/avatar/bb3cf80b7af6b40db1b3b2445ee738a1?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
      <div class="comment-meta comment-meta-data">
        <div class="comment-author vcard">
          <cite class="fn">Phil Pirozhkov</cite>
        </div>
        <!-- .comment-author .vcard -->
        <abbr class="comment-date" title="Sunday, September 30th, 2012, 3:45 pm">September 30, 2012</abbr> at <abbr class="comment-time" title="Sunday, September 30th, 2012, 3:45 pm">3:45 pm</abbr>
      </div>
      <div class="comment-text">
        <p>It&#x2019;s a very good example that EM is still far from being perfect.<br>
This is mostly due to the poor memcached protocol implementation, which adds all these callbacks to an array and is poping it one by one.</p>
        <p>There&#x2019;s a problem in test itself, you should consider that in evented style you never know which operation finishes first, and you cannot be sure that DEL is sent after SET and GET. So this should be better:</p>
        <div class="CodeRay">
          <div class="code">
            <pre>require &apos;em-synchrony&apos;
require &apos;em-synchrony/em-memcache&apos;
def async2
  EventMachine.synchrony do
    cache = EM::P::Memcache.connect
    TEST_SIZE.times do |n|
      cache.set &quot;key#{n}&quot;, &quot;value#{n}&quot;
    end
    TEST_SIZE.times do |n|
      value = cache.get &quot;key#{n}&quot;
    end
    TEST_SIZE.times do |n|
      cache.delete(&quot;key#{n}&quot;)
    end
    EventMachine.stop
  end
end
puts Benchmark.measure { puts &quot;async:&quot;; async2 }
</pre>
          </div>
        </div>
        <p>However, the overhead is the same.</p>
      </div>
      <!-- .comment-text -->
      <ol class="children">
        <li id="comment-22455" class="comment odd alt depth-2 comment reader">
          <img alt="Phil Pirozhkov" src="https://1.gravatar.com/avatar/bb3cf80b7af6b40db1b3b2445ee738a1?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
          <div class="comment-meta comment-meta-data">
            <div class="comment-author vcard">
              <cite class="fn">Phil Pirozhkov</cite>
            </div>
            <!-- .comment-author .vcard -->
            <abbr class="comment-date" title="Sunday, September 30th, 2012, 4:29 pm">September 30, 2012</abbr> at <abbr class="comment-time" title="Sunday, September 30th, 2012, 4:29 pm">4:29 pm</abbr>
          </div>
          <div class="comment-text">
            <p>Forgot to mention that on my machine sync is only 50%-100% faster than async given your benchmark. (2 cores, linux 3.5.4).</p>
          </div>
          <!-- .comment-text -->
        </li>
        <!-- .comment -->
      </ol>
    </li>
    <!-- .comment -->
    <li id="comment-22538" class="comment even thread-odd thread-alt depth-1 comment reader">
      <img alt="Jarmo Pertman" src="https://1.gravatar.com/avatar/ff97ca87af59ee68ceff5877a8365788?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
      <div class="comment-meta comment-meta-data">
        <div class="comment-author vcard">
          <cite class="fn" title="https://itreallymatters.net">Jarmo Pertman</cite>
        </div>
        <!-- .comment-author .vcard -->
        <abbr class="comment-date" title="Thursday, October 4th, 2012, 10:54 am">October 4, 2012</abbr> at <abbr class="comment-time" title="Thursday, October 4th, 2012, 10:54 am">10:54 am</abbr>
      </div>
      <div class="comment-text">
        <p>You could also try Benchmark.bmbm instead of .measure to see if there&#x2019;s any effect when having also the rehearsal phase.</p>
      </div>
      <!-- .comment-text -->
    </li>
    <!-- .comment -->
    <li id="comment-24355" class="comment odd alt thread-even depth-1 comment reader">
      <img alt="Nicol&#xE1;s" src="https://1.gravatar.com/avatar/d26aa7a45965be73497f83347f1800f8?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
      <div class="comment-meta comment-meta-data">
        <div class="comment-author vcard">
          <cite class="fn">Nicol&#xE1;s</cite>
        </div>
        <!-- .comment-author .vcard -->
        <abbr class="comment-date" title="Tuesday, October 30th, 2012, 6:18 am">October 30, 2012</abbr> at <abbr class="comment-time" title="Tuesday, October 30th, 2012, 6:18 am">6:18 am</abbr>
      </div>
      <div class="comment-text">
        <p>Greate post! Waiting for part 3!!!</p>
      </div>
      <!-- .comment-text -->
      <ol class="children">
        <li id="comment-24376" class="comment byuser comment-author-admin bypostauthor even depth-2 comment role-administrator user-admin entry-author">
          <img alt="Phil Whelan" src="https://1.gravatar.com/avatar/5f357d996da96ccd36d3374e3728bf29?s=80&amp;d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=PG" class="avatar avatar-80 photo" height="80" width="80">
          <div class="comment-meta comment-meta-data">
            <div class="comment-author vcard">
              <cite class="fn" title="https://www.google.com/profiles/101358683928607234715">Phil Whelan</cite>
            </div>
            <!-- .comment-author .vcard -->
            <abbr class="comment-date" title="Tuesday, October 30th, 2012, 2:43 pm">October 30, 2012</abbr> at <abbr class="comment-time" title="Tuesday, October 30th, 2012, 2:43 pm">2:43 pm</abbr>
          </div>
          <div class="comment-text">
            <p>Be careful what you wish for&#x2026;<br>
<a href="/rubys-eventmachine-part-3-thin">Ruby&#x2019;s EventMachine &#x2013; Part 3 : Thin</a></p>
          </div>
          <!-- .comment-text -->
        </li>
        <!-- .comment -->
      </ol>
    </li>
    <!-- .comment -->
  </ol>
  <!-- .comment-list -->
</div>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .monokai {
    background-color: #272822;
    color: #f8f8f2;
  }
  .monokai .mtki { font-style: italic; }
  .monokai .mtk7 { color: #F92672; }
  .monokai .mtk1 { color: #F8F8F2; }
  .monokai .mtk6 { color: #E6DB74; }
  .monokai .mtk3 { color: #75715E; }
  .monokai .mtk4 { color: #AE81FF; }
  .monokai .mtk5 { color: #A6E22E; }
  .monokai .mtk10 { color: #FD971F; }
  .monokai .mtk9 { color: #66D9EF; }
  .monokai .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div><div class="Post-module--post__footer--3WzWU"><a href="/"><b>See more posts</b></a><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->24 Sep 2012</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/asynchronous/">asynchronous</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/benchmark/">benchmark</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/event-loop/">event-loop</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/eventmachine/">eventmachine</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/fast/">fast</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/memcached/">memcached</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/ruby/">ruby</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/synchronous/">synchronous</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/tornado/">tornado</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Software Engineer<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/philwhln" rel="noopener noreferrer" target="_blank"><strong>Phil Whelan</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ruby-eventmachine-part-2-asynchronous-not-equal-faster";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b172745a4e06fd8641f8.js"],"app":["/app-1be3f86dc13de6efc5d3.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-3d02ed64efaca327a32d.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-c783365a494b8524316b.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-501d74980b4ca87c648e.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-a2e3c60b704fa68ae02b.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-2ca4fb76ee82d69b6cbb.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-a0fc6e0c604116ad175d.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-c74ee9c024af2c666487.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-bd067b39332a4dfdf0d9.js"]};/*]]>*/</script><script src="/polyfill-b172745a4e06fd8641f8.js" nomodule=""></script><script src="/component---src-templates-post-template-js-a0fc6e0c604116ad175d.js" async=""></script><script src="/643651a62fb35a9bb4f20061cb1f214a352d7976-921c08de707572e0b904.js" async=""></script><script src="/b40c11bee3846ca70ab17cd1bc776b2e57af83cb-10791c46efc983490b73.js" async=""></script><script src="/styles-083a06cb5740baaf347d.js" async=""></script><script src="/app-1be3f86dc13de6efc5d3.js" async=""></script><script src="/framework-d018bf9a55d82f10618c.js" async=""></script><script src="/webpack-runtime-19035f8c288fb702f4ea.js" async=""></script></body></html>